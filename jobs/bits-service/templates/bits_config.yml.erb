buildpacks:
  max_body_size: <%= p("bits-service.buildpacks.max_body_size") %>
  <% if p("bits-service.buildpacks.blobstore_type").downcase == "webdav" %>
  blobstore_type: webdav
  webdav_config:
    public_endpoint: <%= p("bits-service.buildpacks.webdav_config.public_endpoint") %>
    private_endpoint: <%= p("bits-service.buildpacks.webdav_config.private_endpoint") %>
    username: <%= p("bits-service.buildpacks.webdav_config.username") %>
    password: <%= p("bits-service.buildpacks.webdav_config.password") %>
    <% if p("bits-service.buildpacks.webdav_config.ca_cert") != "" && p("bits-service.buildpacks.webdav_config.ca_cert") != nil %>
    ca_cert_path: "/var/vcap/jobs/bits-service/config/certs/buildpacks_ca_cert.pem"
    <% end %>
  <% else %>
  <% if p("bits-service.buildpacks.fog_connection.provider").downcase == "azurerm" %>
  blobstore_type: azure
  <% else %>
  blobstore_type: <%= p("bits-service.buildpacks.fog_connection.provider") %>
  <% end %>
  <% if p("bits-service.buildpacks.fog_connection.provider").downcase == "local" %>
  local_config:
    path_prefix: /var/vcap/store/bits-service/<%= p("bits-service.buildpacks.directory_key") %>
  <% end %>
  <% if p("bits-service.buildpacks.fog_connection.provider").downcase == "aws" %>
  s3_config:
    bucket: <%= p("bits-service.buildpacks.directory_key") %>
    access_key_id: <%= p("bits-service.buildpacks.fog_connection.aws_access_key_id") %>
    secret_access_key: <%= p("bits-service.buildpacks.fog_connection.aws_secret_access_key") %>
    region: <%= p("bits-service.buildpacks.fog_connection.region") %>
    <% if_p("bits-service.buildpacks.fog_connection.host") do | host | %>
    host: <%= host %>
    <% end %>
  <% end %>
  <% if p("bits-service.buildpacks.fog_connection.provider").downcase == "openstack" %>
  openstack_config:
    container_name: <%= p("bits-service.buildpacks.directory_key") %>
    username: <%= p("bits-service.buildpacks.fog_connection.openstack_username") %>
    api_key: <%= p("bits-service.buildpacks.fog_connection.openstack_api_key") %>
    auth_url:  <%= p("bits-service.buildpacks.fog_connection.openstack_auth_url") %>
    domain_id: <%= p("bits-service.buildpacks.fog_connection.openstack_domain_id", '') %>
    region: <%= p("bits-service.buildpacks.fog_connection.openstack_region", '') %>
    account_meta_temp_url_key: <%= p("bits-service.buildpacks.fog_connection.openstack_temp_url_key", '') %>
    tenant:  <%= p("bits-service.buildpacks.fog_connection.openstack_tenant", '') %>
  <% end %>
  <% if p("bits-service.buildpacks.fog_connection.provider").downcase == "azurerm" %>
  azure_config:
    container_name: <%= p("bits-service.buildpacks.directory_key") %>
    account_name: <%= p("bits-service.buildpacks.fog_connection.azure_storage_account_name") %>
    account_key: <%= p("bits-service.buildpacks.fog_connection.azure_storage_access_key") %>
    <% if p("bits-service.buildpacks.fog_connection.environment").downcase == "azurecloud" %>
    environment: AzurePublicCloud
    <% else %>
    environment: <%= p("bits-service.buildpacks.fog_connection.environment") %>
    <% end %>
  <% end %>
  <% end %>

droplets:
  max_body_size: <%= p("bits-service.droplets.max_body_size") %>
  <% if p("bits-service.droplets.blobstore_type").downcase == "webdav" %>
  blobstore_type: webdav
  webdav_config:
    public_endpoint: <%= p("bits-service.droplets.webdav_config.public_endpoint") %>
    private_endpoint: <%= p("bits-service.droplets.webdav_config.private_endpoint") %>
    username: <%= p("bits-service.droplets.webdav_config.username") %>
    password: <%= p("bits-service.droplets.webdav_config.password") %>
    <% if p("bits-service.droplets.webdav_config.ca_cert") != "" && p("bits-service.droplets.webdav_config.ca_cert") != nil %>
    ca_cert_path: "/var/vcap/jobs/bits-service/config/certs/droplets_ca_cert.pem"
    <% end %>
  <% else %>
  <% if p("bits-service.droplets.fog_connection.provider").downcase == "azurerm" %>
  blobstore_type: azure
  <% else %>
  blobstore_type: <%= p("bits-service.droplets.fog_connection.provider") %>
  <% end %>
  <% if p("bits-service.droplets.fog_connection.provider").downcase == "local" %>
  local_config:
    path_prefix: /var/vcap/store/bits-service/<%= p("bits-service.droplets.directory_key") %>
  <% end %>
  <% if p("bits-service.droplets.fog_connection.provider").downcase == "aws" %>
  s3_config:
    bucket: <%= p("bits-service.droplets.directory_key") %>
    access_key_id: <%= p("bits-service.droplets.fog_connection.aws_access_key_id") %>
    secret_access_key: <%= p("bits-service.droplets.fog_connection.aws_secret_access_key") %>
    region: <%= p("bits-service.droplets.fog_connection.region") %>
    <% if_p("bits-service.droplets.fog_connection.host") do | host | %>
    host: <%= host %>
    <% end %>
  <% end %>
  <% if p("bits-service.droplets.fog_connection.provider").downcase == "openstack" %>
  openstack_config:
    container_name: <%= p("bits-service.droplets.directory_key") %>
    username: <%= p("bits-service.droplets.fog_connection.openstack_username") %>
    api_key: <%= p("bits-service.droplets.fog_connection.openstack_api_key") %>
    auth_url:  <%= p("bits-service.droplets.fog_connection.openstack_auth_url") %>
    domain_id: <%= p("bits-service.droplets.fog_connection.openstack_domain_id", '') %>
    region: <%= p("bits-service.droplets.fog_connection.openstack_region", '') %>
    account_meta_temp_url_key: <%= p("bits-service.droplets.fog_connection.openstack_temp_url_key", '') %>
    tenant:  <%= p("bits-service.droplets.fog_connection.openstack_tenant", '') %>
  <% end %>
  <% if p("bits-service.droplets.fog_connection.provider").downcase == "azurerm" %>
  azure_config:
    container_name: <%= p("bits-service.droplets.directory_key") %>
    account_name: <%= p("bits-service.droplets.fog_connection.azure_storage_account_name") %>
    account_key: <%= p("bits-service.droplets.fog_connection.azure_storage_access_key") %>
    <% if p("bits-service.droplets.fog_connection.environment").downcase == "azurecloud" %>
    environment: AzurePublicCloud
    <% else %>
    environment: <%= p("bits-service.droplets.fog_connection.environment") %>
    <% end %>
  <% end %>
  <% end %>

packages:
  max_body_size: <%= p("bits-service.packages.max_body_size") %>
  <% if p("bits-service.packages.blobstore_type").downcase == "webdav" %>
  blobstore_type: webdav
  webdav_config:
    public_endpoint: <%= p("bits-service.packages.webdav_config.public_endpoint") %>
    private_endpoint: <%= p("bits-service.packages.webdav_config.private_endpoint") %>
    username: <%= p("bits-service.packages.webdav_config.username") %>
    password: <%= p("bits-service.packages.webdav_config.password") %>
    <% if p("bits-service.packages.webdav_config.ca_cert") != "" && p("bits-service.packages.webdav_config.ca_cert") != nil %>
    ca_cert_path: "/var/vcap/jobs/bits-service/config/certs/packages_ca_cert.pem"
    <% end %>
  <% else %>
  <% if p("bits-service.packages.fog_connection.provider").downcase == "azurerm" %>
  blobstore_type: azure
  <% else %>
  blobstore_type: <%= p("bits-service.packages.fog_connection.provider") %>
  <% end %>
  <% if p("bits-service.packages.fog_connection.provider").downcase == "local" %>
  local_config:
    path_prefix: /var/vcap/store/bits-service/<%= p("bits-service.packages.directory_key") %>
  <% end %>
  <% if p("bits-service.packages.fog_connection.provider").downcase == "aws" %>
  s3_config:
    bucket: <%= p("bits-service.packages.directory_key") %>
    access_key_id: <%= p("bits-service.packages.fog_connection.aws_access_key_id") %>
    secret_access_key: <%= p("bits-service.packages.fog_connection.aws_secret_access_key") %>
    region: <%= p("bits-service.packages.fog_connection.region") %>
    <% if_p("bits-service.packages.fog_connection.host") do | host | %>
    host: <%= host %>
    <% end %>
  <% end %>
  <% if p("bits-service.packages.fog_connection.provider").downcase == "openstack" %>
  openstack_config:
    container_name: <%= p("bits-service.packages.directory_key") %>
    username: <%= p("bits-service.packages.fog_connection.openstack_username") %>
    api_key: <%= p("bits-service.packages.fog_connection.openstack_api_key") %>
    auth_url:  <%= p("bits-service.packages.fog_connection.openstack_auth_url") %>
    domain_id: <%= p("bits-service.packages.fog_connection.openstack_domain_id", '') %>
    region: <%= p("bits-service.packages.fog_connection.openstack_region", '') %>
    account_meta_temp_url_key: <%= p("bits-service.packages.fog_connection.openstack_temp_url_key", '') %>
    tenant:  <%= p("bits-service.packages.fog_connection.openstack_tenant", '') %>
  <% end %>
  <% if p("bits-service.packages.fog_connection.provider").downcase == "azurerm" %>
  azure_config:
    container_name: <%= p("bits-service.packages.directory_key") %>
    account_name: <%= p("bits-service.packages.fog_connection.azure_storage_account_name") %>
    account_key: <%= p("bits-service.packages.fog_connection.azure_storage_access_key") %>
    <% if p("bits-service.packages.fog_connection.environment").downcase == "azurecloud" %>
    environment: AzurePublicCloud
    <% else %>
    environment: <%= p("bits-service.packages.fog_connection.environment") %>
    <% end %>
  <% end %>
  <% end %>

app_stash:
  max_body_size: <%= p("bits-service.app_stash.max_body_size") %>
  <% if p("bits-service.app_stash.blobstore_type").downcase == "webdav" %>
  blobstore_type: webdav
  webdav_config:
    public_endpoint: <%= p("bits-service.app_stash.webdav_config.public_endpoint") %>
    private_endpoint: <%= p("bits-service.app_stash.webdav_config.private_endpoint") %>
    username: <%= p("bits-service.app_stash.webdav_config.username") %>
    password: <%= p("bits-service.app_stash.webdav_config.password") %>
    <% if p("bits-service.app_stash.webdav_config.ca_cert") != "" && p("bits-service.app_stash.webdav_config.ca_cert") != nil %>
    ca_cert_path: "/var/vcap/jobs/bits-service/config/certs/app_stash_ca_cert.pem"
    <% end %>
  <% else %>
  <% if p("bits-service.app_stash.fog_connection.provider").downcase == "azurerm" %>
  blobstore_type: azure
  <% else %>
  blobstore_type: <%= p("bits-service.app_stash.fog_connection.provider") %>
  <% end %>
  <% if p("bits-service.app_stash.fog_connection.provider").downcase == "local" %>
  local_config:
    path_prefix: /var/vcap/store/bits-service/<%= p("bits-service.app_stash.directory_key") %>
  <% end %>
  <% if p("bits-service.app_stash.fog_connection.provider").downcase == "aws" %>
  s3_config:
    bucket: <%= p("bits-service.app_stash.directory_key") %>
    access_key_id: <%= p("bits-service.app_stash.fog_connection.aws_access_key_id") %>
    secret_access_key: <%= p("bits-service.app_stash.fog_connection.aws_secret_access_key") %>
    region: <%= p("bits-service.app_stash.fog_connection.region") %>
    <% if_p("bits-service.app_stash.fog_connection.host") do | host | %>
    host: <%= host %>
    <% end %>
  <% end %>
  <% if p("bits-service.app_stash.fog_connection.provider").downcase == "openstack" %>
  openstack_config:
    container_name: <%= p("bits-service.app_stash.directory_key") %>
    username: <%= p("bits-service.app_stash.fog_connection.openstack_username") %>
    api_key: <%= p("bits-service.app_stash.fog_connection.openstack_api_key") %>
    auth_url:  <%= p("bits-service.app_stash.fog_connection.openstack_auth_url") %>
    domain_id: <%= p("bits-service.app_stash.fog_connection.openstack_domain_id", '') %>
    region: <%= p("bits-service.app_stash.fog_connection.openstack_region", '') %>
    account_meta_temp_url_key: <%= p("bits-service.app_stash.fog_connection.openstack_temp_url_key", '') %>
    tenant:  <%= p("bits-service.app_stash.fog_connection.openstack_tenant", '') %>
  <% end %>
  <% if p("bits-service.app_stash.fog_connection.provider").downcase == "azurerm" %>
  azure_config:
    container_name: <%= p("bits-service.app_stash.directory_key") %>
    account_name: <%= p("bits-service.app_stash.fog_connection.azure_storage_account_name") %>
    account_key: <%= p("bits-service.app_stash.fog_connection.azure_storage_access_key") %>
    <% if p("bits-service.app_stash.fog_connection.environment").downcase == "azurecloud" %>
    environment: AzurePublicCloud
    <% else %>
    environment: <%= p("bits-service.app_stash.fog_connection.environment") %>
    <% end %>
  <% end %>
  <% end %>

buildpack_cache:
  max_body_size: <%= p("bits-service.buildpack_cache.max_body_size") %>

logging:
  file: /var/vcap/sys/log/bits-service/bits-service.log
  syslog: vcap.bits-service
  level: <%= p("bits-service.logging.level") %>
  max_retries: <%= p("bits-service.logging.max_retries") %>
private_endpoint: <%= p("bits-service.private_endpoint") %>
public_endpoint: <%= p("bits-service.public_endpoint") %>
port: 443
secret: <%= p("bits-service.secret") %>
skip_cert_verify: true
<% if_p("bits-service.cc_updates.ca_cert", "bits-service.cc_updates.client_cert", "bits-service.cc_updates.client_key") do %>
cc_updater:
  endpoint: <%= p("bits-service.cc_updates.cc_url") %>
  ca_cert_file: "/var/vcap/jobs/bits-service/config/certs/mutual_ca_cert.pem"
  client_cert_file: "/var/vcap/jobs/bits-service/config/certs/mutual_client_cert.pem"
  client_key_file: "/var/vcap/jobs/bits-service/config/certs/mutual_client_key.pem"
<% end %>
signing_users:
  <% p('bits-service.signing_users').each do |user| %>
  - username: <%= user['username'] %>
    password: <%= user['password'] %>
  <% end %>
max_body_size: <%= p("bits-service.max_body_size") %>
cert_file: /var/vcap/jobs/bits-service/config/certs/bits_tls.crt
key_file: /var/vcap/jobs/bits-service/config/certs/bits_tls.key
